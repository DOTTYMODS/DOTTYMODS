local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local OpenBtn = Instance.new("ImageButton")
local CloseBtn = Instance.new("TextButton")
local UIStroke = Instance.new("UIStroke")

-- SISTEMA ANTI-REINICIO TOTAL
local function LockReset()
    task.spawn(function()
        while true do
            local success = pcall(function()
                game:GetService("StarterGui"):SetCore("ResetButtonCallback", false)
            end)
            if success then break end
            task.wait(0.5)
        end
    end)
end
LockReset()

ScreenGui.Name = "DottyMods_LuffyDesignMatch"
ScreenGui.Parent = game.CoreGui
ScreenGui.ResetOnSpawn = false 

-- Ventana Principal
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.Position = UDim2.new(0.5, -135, 0.2, 0)
MainFrame.Size = UDim2.new(0, 270, 0, 340) 
MainFrame.Active = true
MainFrame.Draggable = true
UIStroke.Parent = MainFrame
UIStroke.Thickness = 2

-- Título
Title.Text = "DOTTY MODS V1"
Title.Size = UDim2.new(1, 0, 0, 45) 
Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Title.TextColor3 = Color3.fromRGB(255, 255, 255) 
Title.Font = Enum.Font.SourceSansSemibold 
Title.TextSize = 20
local TStroke = Instance.new("UIStroke", Title)
TStroke.Thickness = 1

-- Botón Abrir (FOTO DE LUFFY) 
OpenBtn.Parent = ScreenGui
OpenBtn.Image = "rbxassetid://13589993315"
OpenBtn.Visible = false
OpenBtn.Size = UDim2.new(0, 70, 0, 70) 
OpenBtn.Position = UDim2.new(0, 10, 0.4, 0)
OpenBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
OpenBtn.Draggable = true
local OpenStroke = Instance.new("UIStroke", OpenBtn)
OpenStroke.Thickness = 3
Instance.new("UICorner", OpenBtn).CornerRadius = UDim.new(1, 0) 

-- Función para crear botones estilo imagen (para el menú)
local createdStrokes = {}
local function createStyleBtn(name, pos, sizeX, parentFrame)
    local btn = Instance.new("TextButton")
    btn.Parent = parentFrame or MainFrame
    btn.Size = UDim2.new(sizeX or 0.42, 0, 0, 45) 
    btn.Position = pos
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 14
    local s = Instance.new("UIStroke", btn)
    s.Thickness = 1.5
    table.insert(createdStrokes, s)
    return btn
end

-- Funciones para crear botones flotantes (fuera del menú)
local createdFloatingStrokes = {}
local function createFloatingBtn(name, pos)
    local btn = Instance.new("TextButton", ScreenGui) -- Parent es ScreenGui
    btn.Text = name
    btn.Size = UDim2.new(0, 80, 0, 40)
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 14
    btn.Draggable = true -- Se pueden arrastrar
    local s = Instance.new("UIStroke", btn)
    s.Thickness = 1.5
    table.insert(createdFloatingStrokes, s)
    return btn
end


-- Posiciones ajustadas para el nuevo tamaño del menú
local SaveABtn = createStyleBtn("SAVE A", UDim2.new(0.04, 0, 0.13, 0), 0.92)
local SaveBBtn = createStyleBtn("SAVE B", UDim2.new(0.04, 0, 0.28, 0), 0.92)
local GodBtn = createStyleBtn("GOD ULTRA: OFF", UDim2.new(0.04, 0, 0.43, 0))
local NoclipBtn = createStyleBtn("NOCLIP: OFF", UDim2.new(0.54, 0, 0.43, 0))
local GrabBtn = createStyleBtn("INSTANT GRAB: OFF", UDim2.new(0.04, 0, 0.58, 0))
local JumpBtn = createStyleBtn("INF JUMP: OFF", UDim2.new(0.54, 0, 0.58, 0))

local SpeedInput = Instance.new("TextBox", MainFrame)
SpeedInput.Size = UDim2.new(0.42, 0, 0, 45)
SpeedInput.Position = UDim2.new(0.04, 0, 0.73, 0)
SpeedInput.PlaceholderText = "VEL..."
SpeedInput.Text = "60"
SpeedInput.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
SpeedInput.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedInput.Font = Enum.Font.SourceSansBold
local SpeedStroke = Instance.new("UIStroke", SpeedInput)
SpeedStroke.Thickness = 1
table.insert(createdStrokes, SpeedStroke) 

local SetSpeedBtn = createStyleBtn("SET SPEED", UDim2.new(0.54, 0, 0.73, 0))

-- BOTONES FLOTANTES DE TP
local LoadABtn = createFloatingBtn("TP A", UDim2.new(0.02, 0, 0.6, 0))
local LoadBBtn = createFloatingBtn("TP B", UDim2.new(0.02, 0, 0.7, 0))


-- LOGICA TOTAL 
local god, noclip, grab, infj = false, false, false, false
local posA, posB

game:GetService("RunService").Heartbeat:Connect(function()
    local char = game.Players.LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        if god then 
            char.Humanoid.Health = char.Humanoid.MaxHealth 
            char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
            for _, p in pairs(char:GetDescendants()) do if p:IsA("BasePart") then p.CanTouch = false end end
        else
            char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, true)
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then part.CanTouch = true end
            end
        end
        if noclip then
            for _, v in pairs(char:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide = false end end
        end
    end
end)

GodBtn.MouseButton1Click:Connect(function() god = not god; GodBtn.Text = "GOD ULTRA: "..(god and "ON" or "OFF") end)
NoclipBtn.MouseButton1Click:Connect(function() noclip = not noclip; NoclipBtn.Text = "NOCLIP: "..(noclip and "ON" or "OFF") end)
GrabBtn.MouseButton1Click:Connect(function() grab = not grab; GrabBtn.Text = "INSTANT GRAB: "..(grab and "ON" or "OFF") end)
JumpBtn.MouseButton1Click:Connect(function() infj = not infj; JumpBtn.Text = "INF JUMP: "..(infj and "ON" or "OFF") end)

SaveABtn.MouseButton1Click:Connect(function() if game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then posA = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame end end)
SaveBBtn.MouseButton1Click:Connect(function() if game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then posB = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame end end)
SetSpeedBtn.MouseButton1Click:Connect(function() game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = tonumber(SpeedInput.Text) end)

LoadABtn.MouseButton1Click:Connect(function() if posA then game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = posA end end)
LoadBBtn.MouseButton1Click:Connect(function() if posB then game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = posB end end)

game:GetService("UserInputService").JumpRequest:Connect(function()
    if infj then game.Players.LocalPlayer.Character.Humanoid:ChangeState("Jumping") end
end)

task.spawn(function()
    while task.wait(0.1) do
        if grab then
            for _, v in pairs(workspace:GetDescendants()) do if v:IsA("ProximityPrompt") then v.HoldDuration = 0 end end
        end
    end
end)

-- Cerrar/Abrir Botones
CloseBtn.Text = "X"; CloseBtn.Parent = MainFrame; CloseBtn.Size = UDim2.new(0,30,0,30); CloseBtn.Position = UDim2.new(0.85,0,0,0); CloseBtn.BackgroundTransparency = 1; CloseBtn.TextColor3 = Color3.new(1,0,0)
CloseBtn.MouseButton1Click:Connect(function() MainFrame.Visible = false; OpenBtn.Visible = true; LoadABtn.Visible = true; LoadBBtn.Visible = true; end)
OpenBtn.MouseButton1Click:Connect(function() MainFrame.Visible = true; OpenBtn.Visible = false; end)


-- EFECTO RAINBOW EN TODO
task.spawn(function()
    while true do
        local c = Color3.fromHSV(tick()%5/5, 1, 1)
        UIStroke.Color = c 
        OpenStroke.Color = c 
        TStroke.Color = c 
        Title.TextColor3 = c 
        for _, stroke in ipairs(createdStrokes) do
            stroke.Color = c 
        end
        for _, stroke in ipairs(createdFloatingStrokes) do
             stroke.Color = c
        end
        task.wait()
    end
end)
